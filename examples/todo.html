<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            color: #222;
            font: 14px Arial;
        }
        body a {
            color: #3D5C9D;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <script src="../lib/kagedb.js"></script>
    <script>
        (function () {

            var todos = new KageDB({
                name: "todos",
                upgrade: function (db, complete) {
                    if(db.objectStoreNames.contains("todo")) {
                        db.deleteObjectStore("todo");
                    }
                    db.createObjectStore("todo", {keyPath: "timeStamp"});
                    complete();
                },
                onerror: function (event) {
                    console.error(event.kage_errorMessage);
                }
            });

            function addTodo(todoText, callback) {
                todos.tx(["todo"], function (tx, todo) {
                    todo.put({ text: todoText, timeStamp: new Date().getTime() }, callback);
                });
            }

            function deleteTodo(id, callback) {
                todos.tx(["todo"], function (tx, todo) {
                    todo.delete(id, callback);
                });
            }

            function getAllTodoItems(callback) {
                todos.tx(["todo"], function (tx, todo) {
                    todo.fetch(function (results) {
                        callback(results);
                    });
                });
            }

            function renderTodos(items) {
                var todos = document.getElementById("todoItems");
                todos.innerHTML = "";

                items.forEach(function (item) {
                    var li = document.createElement("li");
                    var a = document.createElement("a");
                    var t = document.createTextNode(item.text);

                    a.addEventListener("click", function() {
                        deleteTodo(item.timeStamp, render);
                    });

                    a.textContent = " [Delete]";
                    li.appendChild(t);
                    li.appendChild(a);
                    todos.appendChild(li)
                });
            }

            function render() {
                getAllTodoItems(renderTodos);
            }

            window.addEventListener("DOMContentLoaded", function () {
                render();

                var add = document.getElementById("add");
                add.addEventListener('click', function (e) {
                    var todo = document.getElementById("todo");
                    if (todo.value !== "") {
                        addTodo(todo.value, render);
                    }
                    todo.value = "";
                });
            });
        }());
    </script>
</head>
<body>
<input type="text" id="todo" name="todo" placeholder="What do you need to do?" style="width: 200px;" />
<input type="button" id="add" value="Add Todo Item"/>
<ul id="todoItems"></ul>
</body>
</html>â€‹